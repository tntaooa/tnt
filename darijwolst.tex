\documentclass{subfile}

\begin{document}
	The following theorem is a generalization of Wolstenholme's theorem. It was proposed and proved by Darij Grinberg on the \textit{Art of Problem Solving} website. Before stating the theorem, we need to define $v_p(x)$ for a rational number $x$.

	Recall section \eqref{sec:powerofprimes} where we defined $v_p(x)$ for $x$ being an \textit{integer} as the greatest power of $p$ which divides $x$. Now, since we are working with fractions, we need to generalize this concept to include rational numbers.

	\begin{definition}
		Let $p$ be a prime and let $x = \frac{a}{b} \neq 0$ be a rational number reduced to lowest terms. Define the \textit{$p$-adic evaluation of $x$} as $v_p(x) = v_p(a)-v_p(b)$, where $v_p(n)$ is the notation defined in definition \eqref{def:vp}.
	\end{definition}

	\begin{example}
		$v_3\left(\frac{9}{16}\right) = 2$, and $v_5\left(\frac{34}{25}\right) = -2$.
	\end{example}

	\begin{note}
		We can easily check the sign of $v_p(x)$ for any rational number $x=\frac{a}{b}$. If $p\mid a$, then $v_p(x)>0$. If $p$ divides none of $a$ and $b$, then $v_p(x)=0$. And if $p\mid b$, then $v_p(x)<0$. Also,  $ v_{p}\left(xy\right) = v_{p}\left(x\right) + v_{p}\left(y\right)$ and $ v_{p}\left(x + y\right)\geq\min\left(v_{p}\left(x\right),v_{p}\left(y\right)\right)$ for all rationals $x$ and $y$.
	\end{note}

	We can now generalize the concept of congruency to include rational numbers.
	\begin{definition}
		If $x$ and $y$ are two rational numbers such that $ v_{p}\left(x\right)\geq 0$ and $ v_{p}\left(y\right)\geq 0$, then we say that $ x\equiv y\pmod p$ if and only if $ v_{p}\left(x - y\right) > 0$.
	\end{definition}

	The following problem gives you a good sight of the above notation.

	\begin{problem}
		Let $p \geq 3$ be a prime. Prove that $p\mid 2^{p-2}+3^{p-2}+6^{p-2}-1$.
	\end{problem}

	\begin{solution}
		Let $a \bot p$ be an integer. We can write $a^{p-2} \equiv \frac{1}{a} \pmod p$ because
			\begin{align*}
				v_p\left(a^p - \frac{1}{a}\right)=v_p\left(\frac{a^{p-1}-1}{a}\right)>0
			\end{align*}
		by Fermat's little theorem. Now
		\begin{align*}
		2^{p-2}+3^{p-2}+6^{p-2}-1 \equiv \frac{1}{2}+\frac{1}{3}+\frac{1}{6}-1 \equiv 0 \pmod p.
		\end{align*}
	\end{solution}

	\begin{theorem}[Darij-Wolstenholme Theorem]
		Let $p>3$ be a prime and let $u$ be a non-negative and odd integer such that $p \geq u+3$. Then
		\begin{align*}
		v_{p}\left(\sum_{k = 1}^{p - 1}\frac {1}{k^{u}}\right)\geq 2
		\end{align*}
	\end{theorem}

	The idea of the proof is similar to the proof of Wolstenholme's theorem. We need to prove a lemma first.

	\begin{lemma}\label{lem:darijwolstproof}
		Let $p$ be a prime and let $n$ be an integer such that $1 \leq n \leq p-2$. Then
		\begin{align*}
		\sum_{k = 1}^{p - 1} k^n \equiv 0 \pmod p.
		\end{align*}
	\end{lemma}

	\begin{proof}
		There exists an integer $a$ co-prime to $p$ such that $p \nmid a^n -1$. The set $A= \{0, 1^n, 2^n, \ldots, (p-1)^n\}$ forms a compete residue system modulo $p$ (why?). Proposition \eqref{prop:generalcompletesystem} says that the set $B=\{0, a^n, (2a)^n, \ldots, ((p-1)a)^n\}$ also forms a complete residue system modulo $p$. Therefore, the sum of elements of both sets are equivalent modulo $p$. So
		\begin{align*}
			\sum_{k = 1}^{p - 1} k^n
				& \equiv \sum_{k = 1}^{p - 1} (a \cdot k)^n\\
				& \equiv a^n \sum_{k = 1}^{p - 1} k^n \pmod p
		\end{align*}
		This means that
			\begin{align*}
				\left(a^k - 1\right) \sum_{k = 1}^{p - 1} k^n \equiv 0 \pmod p
			\end{align*}
		and since $p \nmid a^n -1$, we should have
			\begin{align*}
				\sum_{k = 1}^{p - 1} k^n \equiv 0 \pmod p.
			\end{align*}
		If the proof seemed confusing to you, here is a potentially better version. Consider a primitive root $g$ of $p$ (we already know there is one from modular arithmetic chapter). Then we also know that $\{1,2,\ldots,p-1\}$ can be generated by $g$ (the set $\{1,g,g^2,\ldots,g^{p-2}\}$). So,
			\begin{align*}
				1^n+2^n+\cdots+(p-1)^n & = 1^n+g^n+g^{2n}+\cdots+\left(g^{p-2}\right)^n\\
										&= \dfrac{(g^n)^{p-1}-1}{g^n-1}\\
										& = \dfrac{g^{(p-1)n}-1}{g^n-1}
			\end{align*}
		From Fermat's little theorem, $g^{p-1}\equiv1\pmod p$, so the conclusion follows.
	\end{proof}

	\begin{proof}[Proof of Darij-Wolstenholme Theorem]
		The idea is to use the trick explained in lemma \eqref{lem:wolstproof1}. That is, we write the given sum as a sum of terms of the form $\frac{1}{k^u}+\frac{1}{(p-k)^u}$. We have
		\begin{align*}
		2\sum_{k = 1}^{p - 1}\frac {1}{k^{u}} &= \sum_{k = 1}^{p - 1}\frac {1}{k^{u}} + \sum_{k = 1}^{p - 1}\frac {1}{\left(p - k\right)^{u}}\\
		&= \sum_{k = 1}^{p - 1}\left(\frac {1}{k^{u}} + \frac {1}{\left(p - k\right)^{u}}\right) \\
		&= \sum_{k = 1}^{p - 1}\frac {k^{u} + \left(p - k\right)^{u}}{k^{u}\left(p - k\right)^{u}}\\
		&=\sum_{k = 1}^{p - 1}\frac {k^{u} + \left(p^{u} - up^{u - 1}k+ \cdots + upk^{u - 1} - k^{u}\right)}{k^{u}\left(p - k\right)^{u}} \\
		&= \sum_{k = 1}^{p - 1}\frac {p^{u} - up^{u - 1}k + \cdots + upk^{u - 1}}{k^{u}\left(p - k\right)^{u}}\\
		&=p \cdot \sum_{k = 1}^{p - 1}\frac {p^{u - 1} - up^{u - 2}k+\cdots + uk^{u - 1}}{k^{u}\left(p - k\right)^{u}}
		\end{align*}
		We have used the fact that $u$ is an odd integer to expand $(p-k)^u$ in above lines. Now since $p>3$ is an odd prime, $v_p(2)=0$ and therefore
			\begin{align*}
				v_{p}\left(2\sum_{k = 1}^{p - 1}\frac {1}{k^{u}}\right)
					&= v_{p}\left(2\right) + v_{p}\left(\sum_{k = 1}^{p - 1}\frac {1}{k^{u}}\right)\\
					& = v_{p}\left(\sum_{k = 1}^{p - 1}\frac {1}{k^{u}}\right)\\
					&=v_{p}\left(p \cdot \sum_{k = 1}^{p - 1}\frac {p^{u - 1} - up^{u - 2}k+\cdots + uk^{u - 1}}{k^{u}\left(p - k\right)^{u}}\right)\\
					&=v_{p}\left(p\right) + v_{p}\left(\sum_{k = 1}^{p - 1}\frac {p^{u - 1} - up^{u - 2}k+\cdots + uk^{u - 1}}{k^{u}\left(p - k\right)^{u}}\right)\\
					&=1+v_{p}\left(\sum_{k = 1}^{p - 1}\frac {p^{u - 1} - up^{u - 2}k+\cdots + uk^{u - 1}}{k^{u}\left(p - k\right)^{u}}\right)
			\end{align*}
		So instead of showing $v_{p}\left(2\sum_{k = 1}^{p - 1}\frac {1}{k^{u}}\right) \geq 2$, it is enough to show that
		\begin{align*}
			v_{p}\left(\sum_{k = 1}^{p - 1}\frac {p^{u - 1} - up^{u - 2}k+\cdots + uk^{u - 1}}{k^{u}\left(p - k\right)^{u}}\right)
				& \geq 1
		\end{align*}
		which is equivalent to showing that
		\begin{align*}
			\sum_{k = 1}^{p - 1}\frac {p^{u - 1} - up^{u - 2}k+\cdots + uk^{u - 1}}{k^{u}\left(p - k\right)^{u}}
				& \equiv 0 \pmod p
		\end{align*}
		Since $p^{u - 1} - up^{u - 2}k+\cdots + uk^{u - 1} \equiv uk^{u - 1} \pmod p$ and $k^{u}\left(p - k\right)^{u} \equiv k^{u}\left( - k\right)^{u} \equiv (-1)^u k^{2u} \pmod p$, we should prove that
			\begin{align*}
				\sum_{k = 1}^{p - 1}\frac {uk^{u - 1}}{\left( - 1\right)^{u}k^{2u}}
					& \equiv\frac {u}{\left( - 1\right)^{u}}\sum_{k = 1}^{p - 1}k^{ - u - 1}\\
					& \equiv 0 \pmod p
			\end{align*}
		From Fermat's little theorem, we have $k^{p-1} \equiv 1 \pmod p$ for every $k$ such that $1 \leq k \leq p-1$. So $ k^{ - u - 1}\equiv k^{ - u - 1}k^{p - 1} = k^{p - u - 2}\pmod p$ and we must prove that
		\begin{align*}
		\frac {u}{\left( - 1\right)^{u}}\sum_{k = 1}^{p - 1}k^{p - u - 2}\equiv 0 \pmod p
		\end{align*}
		which follows directly from lemma \eqref{lem:darijwolstproof} because $ 1\leq p - u - 2\leq p - 2$. The proof is complete.
	\end{proof}

	\begin{problem}
		Let $p>3$ be a prime. Prove that
		\begin{align*}
		\sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {\left( - 1\right)^{i - 1}}{i} \equiv 0 \pmod p
		\end{align*}
	\end{problem}

	\begin{solution}
		First, let us prove that
		\begin{align}\label{eq:primefloor}
		p - \left\lfloor \left\lfloor 2p/3\right\rfloor /2\right\rfloor = \left\lfloor 2p/3\right\rfloor + 1
		\end{align}
		where $\lfloor x \rfloor$ is the largest integer not greater than $x$ for any real $x$. Since $p>3$, either $p \equiv 1 \pmod 3$ or $p \equiv 2 \pmod 3$. Consider both cases:
		\begin{itemize}
			\item If $p \equiv 1 \pmod 3$, then $\frac{p-1}{3}$ is an integer and
			\begin{align*}
			2\cdot\frac {p - 1}{3}\leq\frac {2p}{3} < 2\cdot\frac {p - 1}{3} + 1
			\end{align*}
			which means
			\begin{align*}
			\left\lfloor\frac {2p}{3}\right\rfloor &= 2\cdot\frac {p - 1}{3},\\
			\left\lfloor\left\lfloor\frac {2p}{3}\right\rfloor /2\right\rfloor &= \left\lfloor\left(2\cdot\frac {p - 1}{3}\right)/2\right\rfloor = \frac {p - 1}{3}
			\end{align*}
			Finally,
			\begin{align*}
			p - \left\lfloor\left\lfloor\frac {2p}{3}\right\rfloor /2\right\rfloor = p - \frac {p - 1}{3} = 2\cdot\frac {p - 1}{3} + 1 = \left\lfloor\frac {2p}{3}\right\rfloor + 1
			\end{align*}
			as desired.

			\item If $p \equiv 2 \pmod 3$, then $\frac{p-2}{3}$ is an integer and
			\begin{align*}
			2\cdot\frac {p - 2}{3} + 1\leq\frac {2p}{3} < \left(2\cdot\frac {p - 2}{3} + 1\right) + 1
			\end{align*}
			This gives
			\begin{align*}
			\left\lfloor\frac {2p}{3}\right\rfloor
				&= 2\cdot\frac {p - 2}{3} + 1\\
			\left\lfloor\left\lfloor\frac {2p}{3}\right\rfloor /2\right\rfloor
				& =	\left\lfloor\left(2\cdot\frac {p - 2}{3} + 1\right)/2\right\rfloor\\
				& = \left\lfloor\frac {p - 2}{3} + \frac {1}{2}\right\rfloor\\
				& = \frac{p-2}{3}
			\end{align*}
			And finally
				\begin{align*}
					p - \left\lfloor\left\lfloor\frac {2p}{3}\right\rfloor /2\right\rfloor
						& = p - \frac {p - 2}{3}\\
						& = \left(2\cdot\frac {p - 2}{3} + 1\right) + 1\\
						& = \left\lfloor\frac {2p}{3}\right\rfloor + 1
				\end{align*}
		\end{itemize}
		The proof of equation \eqref{eq:primefloor} is finished. We will now prove the problem. Obviously,
			\begin{align*}
				\sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {\left( - 1\right)^{i - 1}}{i}
					&= \sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
						i\text{ is odd}}}\frac {1}{i} + \sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
						i\text{ is even}}}\frac { - 1}{i} \\
					&= \sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
							i\text{ is odd}}}\frac {1}{i} - \sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
							i\text{ is even}}}\frac {1}{i}\\
					&= \left(\sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
							i\text{ is odd}}}\frac {1}{i} + \sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
							i\text{ is even}}}\frac {1}{i}\right) - 2\sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
							i\text{ is even}}}\frac {1}{i} \\
					&= \sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {1}{i} - 2\sum_{\substack{1\leq i\leq \left\lfloor 2p/3\right\rfloor ; \\
							i\text{ is even}}}\frac {1}{i}\\
					&= \sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {1}{i} - 2\sum_{j = 1}^{\left\lfloor \left\lfloor 2p/3\right\rfloor /2\right\rfloor}\frac {1}{2j} \\
					&= \sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {1}{i} + \sum_{j = 1}^{\left\lfloor \left\lfloor 2p/3\right\rfloor /2\right\rfloor}\frac {1}{ - j}\\
					&\equiv\sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {1}{i} + \sum_{j = 1}^{\left\lfloor \left\lfloor 2p/3\right\rfloor /2\right\rfloor}\frac {1}{p - j} \pmod p
			\end{align*}
		In the second sum in the last line of above equations, we have used the fact that $-j \equiv p-j \pmod p$. Replacing $ j$ by $ p - i$ in the second sum, we have
		\begin{align*}
		\sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {\left( - 1\right)^{i - 1}}{i} &\equiv \sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {1}{i} + \sum_{i = p - \left\lfloor \left\lfloor 2p/3\right\rfloor /2\right\rfloor}^{p - 1}\frac {1}{i}
		\end{align*}
		Using \eqref{eq:primefloor}, we can write $i = p - \left\lfloor \left\lfloor 2p/3\right\rfloor /2\right\rfloor = \left\lfloor 2p/3\right\rfloor + 1$ and so by Wolstenholme's theorem,
		\begin{align*}
		\sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {\left( - 1\right)^{i - 1}}{i}  &\equiv \sum_{i = 1}^{\left\lfloor 2p/3\right\rfloor}\frac {1}{i} + \sum_{i = \left\lfloor 2p/3\right\rfloor + 1}^{p - 1}\frac {1}{i}\\
		&\equiv \sum_{i = 1}^{p - 1}\frac {1}{i}\pmod p\\
		&\equiv 0 \pmod p
		\end{align*}
		This finishes the proof of the problem.
	\end{solution}
\end{document}